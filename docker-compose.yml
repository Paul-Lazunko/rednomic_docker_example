version: '2'

networks:
  app-network:
    driver: bridge

services:
  redis:
    image: 'bitnami/redis:latest'
    container_name: redis
    ports:
      - "6379:6379"
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    networks:
      - app-network
  unit_a:
    depends_on:
      - redis
    image: 'unit_a'
    build:
      context: ./
      dockerfile: ./unit/Dockerfile
      args:
        unitId: unit_a
    container_name: unit_a
    networks:
      - app-network
  unit_b:
    depends_on:
      - redis
    image: 'unit_b'
    build:
      context: ./
      dockerfile: ./unit/Dockerfile
      args:
        unitId: unit_b
    container_name: unit_b
    networks:
      - app-network
  entry_point:
    depends_on:
      - redis
    image: 'entry_point'
    build:
      context: ./
      dockerfile: ./server/Dockerfile
    container_name: entry_point
    ports:
      - "3000:3000"
    networks:
      - app-network
  unit_group:
    image: 'unit_group'
    depends_on:
      - redis
    build:
      context: ./
      dockerfile: ./unit_group/Dockerfile
      args:
        unitId: unit_group
        units: 'unit_a unit_b'
    container_name: unit_group
    networks:
      - app-network
